(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     67005,       1993]
NotebookOptionsPosition[     60730,       1781]
NotebookOutlinePosition[     61654,       1816]
CellTagsIndexPosition[     61512,       1809]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Squarified Treemap", "Title",
 CellChangeTimes->{{3.60251229732694*^9, 3.602512300087603*^9}}],

Cell[TextData[{
 "A Functional Implementation in ",
 StyleBox["Mathematica",
  FontSlant->"Italic"]
}], "Subtitle",
 CellChangeTimes->{{3.6025123213022327`*^9, 3.602512336719819*^9}}],

Cell["By Jeffrey Starr, 2014-02", "Subsubtitle",
 CellChangeTimes->{{3.6025123424867687`*^9, 3.602512366358447*^9}}],

Cell[CellGroupData[{

Cell["Abstract", "Section",
 CellChangeTimes->{{3.602512406917881*^9, 3.602512409112266*^9}}],

Cell[TextData[{
 "This paper presents an implementation of the Squarified Treemap algorithm \
(originally published by Bruls, Huizing, and van Wijk)",
 ButtonBox[Cell[TextData[StyleBox[ButtonBox["1"],
  FontVariations->{"CompatibilityType"->"Superscript"}]], "Citation",
  Editable->False,
  TaggingRules->{NoteData -> RowBox[{
       RowBox[{"M", ".", " ", "Bruls"}], ",", " ", 
       RowBox[{"K", ".", " ", "Huizing"}], ",", " ", 
       RowBox[{"and", " ", 
         RowBox[{"J", ".", " ", "van"}], " ", "Wijk"}], ",", " ", 
       RowBox[{
        "\"Squarified treemaps,\"", " ", "in", " ", "Proceedings", " ", "of", 
         " ", "the", " ", "Joint", " ", "Eurographics", " ", "and", " ", 
         "IEEE", " ", "TCVG", " ", "Symposium", " ", "on", " ", 
         "Visualization"}], ",", " ", 
       RowBox[{
         RowBox[{"pp", ".", " ", "33"}], "-", "42"}], ",", " ", "2000.", 
       " "}]}],
  BaseStyle->"Hyperlink",
  ButtonData->"00007748"],
 " for a single-level of hierarchy written in a functional style using the ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " language."
}], "Text",
 CellChangeTimes->{{3.6025125470626707`*^9, 3.6025125808567944`*^9}, {
  3.602512802489868*^9, 3.6025128025370903`*^9}, {3.60251284608927*^9, 
  3.602512898216193*^9}, {3.602513643116025*^9, 3.602513643130681*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Introduction", "Section",
 CellChangeTimes->{{3.6025124124305143`*^9, 3.602512413744054*^9}}],

Cell[TextData[{
 "A treemap is a popular visualization technique because of its density (high \
data content per square inch) and ability to handle hierarchical data. \
Treemaps visualize quantities by creating rectangles with areas that match \
(proportionally, at least) the original quantities. Viewers compare values by \
comparing areas. By using rectangles, treemaps are more dense than pie charts \
and there is evidence humans can compare areas of rectangles more accurately \
than wedges of a circle. Treemaps can also connote hierarchy by embedding \
rectangles in other rectangles recursively. This technique is often used to \
help viewers find files consuming excessive disk space by plotting the file \
size as the area of the rectangle and embedding the file rectangles within \
other rectangles to show the directory structure.",
 ButtonBox[Cell[TextData[StyleBox[ButtonBox["2"],
  FontVariations->{"CompatibilityType"->"Superscript"}]], "Citation",
  Editable->False,
  TaggingRules->{NoteData -> RowBox[{
       RowBox[{"http", ":"}], "//", 
       RowBox[{
         RowBox[{
           RowBox[{"en", ".", "wikipedia", ".", "org"}], "/", "wiki"}], "/", 
         RowBox[{"File", ":", 
           RowBox[{"Tree_Map", ".", "png"}]}]}]}]}],
  BaseStyle->"Hyperlink",
  ButtonData->"000035FD"]
}], "Text",
 CellChangeTimes->{{3.602512986095559*^9, 3.6025130406678047`*^9}, {
  3.602513145579069*^9, 3.60251317483816*^9}, {3.602513217901408*^9, 
  3.602513547911072*^9}, {3.602513643093647*^9, 3.602513643169352*^9}, {
  3.602528042350157*^9, 3.602528044870391*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Rectangle, the Core Data Structure\
\>", "Section",
 CellChangeTimes->{{3.6025124217268248`*^9, 3.6025124265904093`*^9}}],

Cell["\<\
The Squarified Treemap algorithm draws rectangles in other rectangles. Not \
all treemap algorithms use rectangles, but rectangles are the most popular \
choice.\
\>", "Text",
 CellChangeTimes->{{3.60251390688922*^9, 3.602513971931239*^9}}],

Cell[TextData[{
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " provides an existing data structure for a Rectangle which we will use \
within this paper."
}], "Text",
 CellChangeTimes->{{3.602513982994248*^9, 3.602514013142123*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"?", "Rectangle"}]], "Input",
 CellChangeTimes->{{3.602513988328244*^9, 3.602513989804492*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox["\<\"\\!\\(\\*RowBox[{\\\"Rectangle\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"x\\\", \
\\\"TI\\\"], StyleBox[\\\"min\\\", \\\"TI\\\"]], \\\",\\\", \
SubscriptBox[StyleBox[\\\"y\\\", \\\"TI\\\"], StyleBox[\\\"min\\\", \
\\\"TI\\\"]]}], \\\"}\\\"}], \\\",\\\", RowBox[{\\\"{\\\", \
RowBox[{SubscriptBox[StyleBox[\\\"x\\\", \\\"TI\\\"], StyleBox[\\\"max\\\", \
\\\"TI\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"y\\\", \\\"TI\\\"], \
StyleBox[\\\"max\\\", \\\"TI\\\"]]}], \\\"}\\\"}]}], \\\"]\\\"}]\\) is a \
two-dimensional graphics primitive that represents a filled rectangle, \
oriented parallel to the axes. \\n\\!\\(\\*RowBox[{\\\"Rectangle\\\", \\\"[\\\
\", RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"x\\\", \\\"TI\\\"], \
StyleBox[\\\"min\\\", \\\"TI\\\"]], \\\",\\\", \
SubscriptBox[StyleBox[\\\"y\\\", \\\"TI\\\"], StyleBox[\\\"min\\\", \
\\\"TI\\\"]]}], \\\"}\\\"}], \\\"]\\\"}]\\) corresponds to a unit square with \
its bottom-left corner at \\!\\(\\*RowBox[{\\\"{\\\", \
RowBox[{SubscriptBox[StyleBox[\\\"x\\\", \\\"TI\\\"], StyleBox[\\\"min\\\", \
\\\"TI\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"y\\\", \\\"TI\\\"], \
StyleBox[\\\"min\\\", \\\"TI\\\"]]}], \\\"}\\\"}]\\).\"\>", "MSG"], 
  "\[NonBreakingSpace]", 
  ButtonBox[
   StyleBox["\[RightSkeleton]", "SR"],
   Active->True,
   BaseStyle->"Link",
   ButtonData->"paclet:ref/Rectangle"]}]], "Print", "PrintUsage",
 CellChangeTimes->{3.602513991088416*^9},
 CellTags->"Info3602488790-5614751"]
}, Open  ]],

Cell["\<\
Note that x and y refer to Cartesian coordinates, not screen coordinates. \
Beyond this data structure, we need several utility functions:\
\>", "Text",
 CellChangeTimes->{{3.602514066246089*^9, 3.602514093781376*^9}, {
  3.602514593525462*^9, 3.602514606861079*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Coord", "[", 
   RowBox[{"side_", ",", 
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"xmin_", ",", "ymin_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"xmax_", ",", "ymax_"}], "}"}]}], "]"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Switch", "[", 
   RowBox[{
   "side", ",", "\[IndentingNewLine]", "Top", ",", "ymax", ",", 
    "\[IndentingNewLine]", "Bottom", ",", "ymin", ",", "\[IndentingNewLine]", 
    "Left", ",", "xmin", ",", "\[IndentingNewLine]", "Right", ",", "xmax"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.602514249279409*^9, 3.602514299271318*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Width", "[", "r_Rectangle", "]"}], ":=", 
  RowBox[{"Abs", "[", 
   RowBox[{
    RowBox[{"Coord", "[", 
     RowBox[{"Right", ",", "r"}], "]"}], "-", 
    RowBox[{"Coord", "[", 
     RowBox[{"Left", ",", "r"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6025140986873617`*^9, 3.602514126365499*^9}, {
  3.602514303736308*^9, 3.602514331840534*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Height", "[", "r_Rectangle", "]"}], ":=", 
  RowBox[{"Abs", "[", 
   RowBox[{
    RowBox[{"Coord", "[", 
     RowBox[{"Top", ",", "r"}], "]"}], "-", 
    RowBox[{"Coord", "[", 
     RowBox[{"Bottom", ",", "r"}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.602514136041719*^9, 3.602514153257781*^9}, {
  3.602514334915262*^9, 3.602514353930279*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Area", "[", "r_Rectangle", "]"}], ":=", 
  RowBox[{
   RowBox[{"Width", "[", "r", "]"}], "\[Times]", 
   RowBox[{"Height", "[", "r", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.602514156050433*^9, 3.6025141732635*^9}}],

Cell["\<\
The aspect ratio of a rectangle is the proportion of the longest edge to the \
shorter edge (thus, the aspect ratio is always greater than or equal to one). \
For a degenerate rectangle (where either the height or width is zero), we \
will define the aspect ratio as infinite.\
\>", "Text",
 CellChangeTimes->{{3.602514487999433*^9, 3.602514531968882*^9}, {
  3.6025147738404093`*^9, 3.6025147972083683`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"RectAspectRatio", "[", "r_Rectangle", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Which", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Width", "[", "r", "]"}], "\[Equal]", "0"}], "\[Or]", 
     RowBox[{
      RowBox[{"Height", "[", "r", "]"}], "\[Equal]", "0"}]}], ",", 
    "\[Infinity]", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Width", "[", "r", "]"}], "\[GreaterEqual]", 
     RowBox[{"Height", "[", "r", "]"}]}], ",", 
    RowBox[{
     RowBox[{"Width", "[", "r", "]"}], "/", 
     RowBox[{"Height", "[", "r", "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Width", "[", "r", "]"}], "<", 
     RowBox[{"Height", "[", "r", "]"}]}], ",", 
    RowBox[{
     RowBox[{"Height", "[", "r", "]"}], "/", 
     RowBox[{"Width", "[", "r", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.602514611789196*^9, 3.6025146358873034`*^9}, {
  3.602514677447462*^9, 3.60251473719063*^9}, {3.602514818784328*^9, 
  3.602514823319127*^9}}],

Cell[CellGroupData[{

Cell["Examples: Rectangle Functions", "Subsection",
 CellChangeTimes->{{3.602514937342263*^9, 3.602514949362136*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"r", "=", 
     RowBox[{"Rectangle", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "4"}], "}"}]}], "]"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Width", "[", "r", "]"}], ",", 
     RowBox[{"Height", "[", "r", "]"}], ",", 
     RowBox[{"Area", "[", "r", "]"}], ",", 
     RowBox[{"RectAspectRatio", "[", "r", "]"}]}], "}"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.602515023293647*^9, 3.602515058063097*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"6", ",", "4", ",", "24", ",", 
   FractionBox["3", "2"]}], "}"}]], "Output",
 CellChangeTimes->{3.602515058695375*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Sidebar: Visualization", "Section",
 CellChangeTimes->{{3.6025124309303007`*^9, 3.602512433483222*^9}}],

Cell[TextData[{
 "The algorithm presented in this paper is independent of a graphical \
rendering system. However, as we generate rectangles, it is useful to see \
them plotted for verification. The function below takes a list of rectangles \
and plots them, with axes and a gridline, using ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\[CloseCurlyQuote]s graphic capabilities."
}], "Text",
 CellChangeTimes->{{3.602515135558648*^9, 3.602515196242763*^9}, {
  3.6025152311015673`*^9, 3.602515274753561*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisualizeRectangles", "[", "rectangles_List", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Join", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"EdgeForm", "[", 
         RowBox[{"{", 
          RowBox[{"Thick", ",", "Black"}], "}"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Opacity", "[", 
         RowBox[{"7", "/", "10"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Riffle", "[", 
       RowBox[{"rectangles", ",", 
        RowBox[{"ColorData", "[", 
         RowBox[{"\"\<Atoms\>\"", ",", "\"\<ColorList\>\""}], "]"}]}], 
       "]"}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
    RowBox[{"GridLines", "\[Rule]", "Automatic"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.602515278425621*^9, 3.602515336023107*^9}, {
  3.6025154173202744`*^9, 3.602515443053116*^9}, {3.602515497079618*^9, 
  3.6025155330085278`*^9}, {3.602515568790036*^9, 3.602515586754239*^9}, {
  3.60251562710681*^9, 3.60251568403454*^9}, {3.6025157303815317`*^9, 
  3.6025157324099073`*^9}, {3.602515788417534*^9, 3.602515789191833*^9}}],

Cell["As an example of the output:", "Text",
 CellChangeTimes->{{3.6025158046922827`*^9, 3.602515809390152*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"VisualizeRectangles", "[", "\[IndentingNewLine]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2"}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "4"}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"33", "/", "7"}], ",", 
        RowBox[{"7", "/", "3"}]}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"33", "/", "7"}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"6", ",", 
        RowBox[{"7", "/", "3"}]}], "}"}]}], "]"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.602515338112273*^9, 3.602515408705777*^9}}],

Cell[BoxData[
 GraphicsBox[
  {Opacity[
    NCache[
     Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
   RectangleBox[{0, 0}, {6, 4}], 
   {RGBColor[0.65, 0.7, 0.7], RectangleBox[{0, 0}, {3, 2}]}, 
   {RGBColor[0.836713, 1., 1.], RectangleBox[{0, 2}, {3, 4}]}, 
   {RGBColor[0.799435, 0.543572, 0.997559], 
    RectangleBox[{3, 0}, 
     NCache[{Rational[33, 7], Rational[7, 3]}, {4.714285714285714, 
      2.3333333333333335`}]]}, 
   {RGBColor[0.770565, 0.964309, 0.0442359], 
    RectangleBox[NCache[{Rational[33, 7], 0}, {4.714285714285714, 0}], 
     NCache[{6, Rational[7, 3]}, {6, 2.3333333333333335`}]]}},
  Axes->True,
  GridLines->Automatic]], "Output",
 CellChangeTimes->{{3.602515409402169*^9, 3.602515445548841*^9}, {
   3.602515501469252*^9, 3.602515534721202*^9}, {3.602515573001834*^9, 
   3.602515588405188*^9}, {3.6025156314626827`*^9, 3.602515638642147*^9}, {
   3.602515670836679*^9, 3.602515686030405*^9}, 3.602515734677187*^9, 
   3.602515790798029*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Filling a Rectangle", "Section",
 CellChangeTimes->{{3.602512437622459*^9, 3.6025124402294064`*^9}}],

Cell["\<\
Given a rectangle and a list of desired areas for sub-rectangles (the sum of \
those areas is equal to or less than the area of the parent rectangle), we \
can iteratively fill the parent rectangle with child rectangles. For the \
squarified treemap algorithm, we fill in rectangles either vertically (stack \
children on top of each other, flushed to the left) or horizontally (stack \
children to the right of each other, flush to the left and right edges and \
growing upwards).\
\>", "Text",
 CellChangeTimes->{{3.602521732520616*^9, 3.602521830525378*^9}, {
  3.602521868782551*^9, 3.60252189247863*^9}}],

Cell["\<\
In the vertical case, the height of each rectangle is proportional and scaled \
to the total areas of the children and the fixed height of the parent. \
Contrawise, in the horizontal case, the widths of each rectangles are \
proportional and scaled to the fixed width of the parent. Within these \
constraints, the width or height (respectively) can be computed using the \
child\[CloseCurlyQuote]s desired area.\
\>", "Text",
 CellChangeTimes->{{3.602521931954714*^9, 3.602522075430972*^9}, {
  3.602528070519577*^9, 3.6025280706846952`*^9}}],

Cell[CellGroupData[{

Cell["Fill Vertically", "Subsection",
 CellChangeTimes->{{3.6025221581371937`*^9, 3.60252217392708*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FillRectangle", "[", 
   RowBox[{"parent_Rectangle", ",", 
    RowBox[{"{", "}"}], ",", "Vertical"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}]], "Input",
 CellChangeTimes->{{3.6025221220406637`*^9, 3.60252213279101*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FillRectangle", "[", 
   RowBox[{"parent_Rectangle", ",", "areas_List", ",", "Vertical"}], "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"heights", "=", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Height", "[", "parent", "]"}], "*", 
         RowBox[{
          RowBox[{"Accumulate", "[", "areas", "]"}], "/", 
          RowBox[{"Total", "[", "areas", "]"}]}]}], ",", "0"}], "]"}]}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Rectangle", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Coord", "[", 
           RowBox[{"Left", ",", "parent"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Coord", "[", 
            RowBox[{"Bottom", ",", "parent"}], "]"}], "+", 
           RowBox[{"heights", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Coord", "[", 
            RowBox[{"Left", ",", "parent"}], "]"}], "+", 
           RowBox[{
            RowBox[{"areas", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"heights", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", 
              RowBox[{"heights", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Coord", "[", 
            RowBox[{"Bottom", ",", "parent"}], "]"}], "+", 
           RowBox[{"heights", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{
         RowBox[{"Length", "[", "heights", "]"}], "-", "1"}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.60252216559378*^9, 3.602522324750126*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fill Horizontally", "Subsection",
 CellChangeTimes->{{3.602522331273534*^9, 3.602522335438644*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FillRectangle", "[", 
   RowBox[{"parent_Rectangle", ",", 
    RowBox[{"{", "}"}], ",", "Horizontal"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}]], "Input",
 CellChangeTimes->{{3.602522342061584*^9, 3.60252235170019*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FillRectangle", "[", 
   RowBox[{"parent_Rectangle", ",", "areas_List", ",", "Horizontal"}], "]"}], 
  ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"widths", "=", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Width", "[", "parent", "]"}], "*", 
         RowBox[{
          RowBox[{"Accumulate", "[", "areas", "]"}], "/", 
          RowBox[{"Total", "[", "areas", "]"}]}]}], ",", "0"}], "]"}]}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Rectangle", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Coord", "[", 
            RowBox[{"Left", ",", "parent"}], "]"}], "+", 
           RowBox[{"widths", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Coord", "[", 
           RowBox[{"Bottom", ",", "parent"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Coord", "[", 
            RowBox[{"Left", ",", "parent"}], "]"}], "+", 
           RowBox[{"widths", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Coord", "[", 
            RowBox[{"Bottom", ",", "parent"}], "]"}], "+", 
           RowBox[{
            RowBox[{"areas", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"widths", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", 
              RowBox[{"widths", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{
         RowBox[{"Length", "[", "widths", "]"}], "-", "1"}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.60252235450422*^9, 3.6025225367351723`*^9}, {
  3.602522751449252*^9, 3.602522752332734*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Examples: Fill Horizontally and Vertically\
\>", "Subsection",
 CellChangeTimes->{{3.602522546907572*^9, 3.6025225625755053`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"parent", "=", 
      RowBox[{"Rectangle", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "4"}], "}"}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"p2", "=", 
      RowBox[{"Rectangle", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "4"}], "}"}]}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"GraphicsRow", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"VisualizeRectangles", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "parent", "}"}], ",", 
          RowBox[{"FillRectangle", "[", 
           RowBox[{"parent", ",", 
            RowBox[{"{", "6", "}"}], ",", "Vertical"}], "]"}]}], "]"}], "]"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"VisualizeRectangles", "[", "\[IndentingNewLine]", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "parent", "}"}], ",", 
          RowBox[{"FillRectangle", "[", 
           RowBox[{"parent", ",", 
            RowBox[{"{", 
             RowBox[{"6", ",", "6"}], "}"}], ",", "Vertical"}], "]"}]}], 
         "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"VisualizeRectangles", "[", "\[IndentingNewLine]", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "parent", "}"}], ",", 
          RowBox[{"FillRectangle", "[", 
           RowBox[{"parent", ",", 
            RowBox[{"{", 
             RowBox[{"6", ",", "6", ",", "4"}], "}"}], ",", "Vertical"}], 
           "]"}]}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"VisualizeRectangles", "[", "\[IndentingNewLine]", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "parent", "}"}], ",", 
          RowBox[{"FillRectangle", "[", 
           RowBox[{"p2", ",", 
            RowBox[{"{", "4", "}"}], ",", "Horizontal"}], "]"}]}], "]"}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"VisualizeRectangles", "[", "\[IndentingNewLine]", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "parent", "}"}], ",", 
          RowBox[{"FillRectangle", "[", 
           RowBox[{"p2", ",", 
            RowBox[{"{", 
             RowBox[{"4", ",", "3"}], "}"}], ",", "Horizontal"}], "]"}]}], 
         "]"}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Spacings", "\[Rule]", "0"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.602522589250082*^9, 3.602522718517283*^9}, {
  3.6025227820603933`*^9, 3.602522949079773*^9}, {3.602523180178748*^9, 
  3.602523222517927*^9}}],

Cell[BoxData[
 GraphicsBox[{{}, {InsetBox[
     GraphicsBox[
      {Opacity[
        NCache[
         Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
       RectangleBox[{0, 0}, {6, 4}], 
       {RGBColor[0.65, 0.7, 0.7], 
        RectangleBox[{0, 0}, NCache[{Rational[3, 2], 4}, {1.5, 4}]]}},
      Axes->True,
      GridLines->Automatic], {180, -126.}, 
     ImageScaled[{0.5, 0.5}], {360, 240.}], InsetBox[
     GraphicsBox[
      {Opacity[
        NCache[
         Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
       RectangleBox[{0, 0}, {6, 4}], 
       {RGBColor[0.65, 0.7, 0.7], RectangleBox[{0, 0}, {3, 2}]}, 
       {RGBColor[0.836713, 1., 1.], RectangleBox[{0, 2}, {3, 4}]}},
      Axes->True,
      GridLines->Automatic], {540, -126.}, 
     ImageScaled[{0.5, 0.5}], {360, 240.}], InsetBox[
     GraphicsBox[
      {Opacity[
        NCache[
         Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
       RectangleBox[{0, 0}, {6, 4}], 
       {RGBColor[0.65, 0.7, 0.7], 
        RectangleBox[{0, 0}, NCache[{4, Rational[3, 2]}, {4, 1.5}]]}, 
       {RGBColor[0.836713, 1., 1.], 
        RectangleBox[NCache[{0, Rational[3, 2]}, {0, 1.5}], {4, 3}]}, 
       {RGBColor[0.799435, 0.543572, 0.997559], RectangleBox[{0, 3}, {4, 4}]}},
      Axes->True,
      GridLines->Automatic], {900, -126.}, 
     ImageScaled[{0.5, 0.5}], {360, 240.}], InsetBox[
     GraphicsBox[
      {Opacity[
        NCache[
         Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
       RectangleBox[{0, 0}, {6, 4}], 
       {RGBColor[0.65, 0.7, 0.7], 
        RectangleBox[{3, 0}, 
         NCache[{6, Rational[4, 3]}, {6, 1.3333333333333333`}]]}},
      Axes->True,
      GridLines->Automatic], {1260, -126.}, 
     ImageScaled[{0.5, 0.5}], {360, 240.}], InsetBox[
     GraphicsBox[
      {Opacity[
        NCache[
         Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
       RectangleBox[{0, 0}, {6, 4}], 
       {RGBColor[0.65, 0.7, 0.7], 
        RectangleBox[{3, 0}, 
         NCache[{Rational[33, 7], Rational[7, 3]}, {4.714285714285714, 
          2.3333333333333335`}]]}, 
       {RGBColor[0.836713, 1., 1.], 
        RectangleBox[NCache[{Rational[33, 7], 0}, {4.714285714285714, 0}], 
         NCache[{6, Rational[7, 3]}, {6, 2.3333333333333335`}]]}},
      Axes->True,
      GridLines->Automatic], {1620, -126.}, 
     ImageScaled[{0.5, 0.5}], {360, 240.}]}, {}},
  ContentSelectable->True,
  ImageSize->Large,
  PlotRangePadding->{6, 5}]], "Output",
 CellChangeTimes->{{3.602522669102851*^9, 3.602522684075815*^9}, 
   3.602522719186677*^9, 3.602522760020602*^9, 3.602522806317026*^9, {
   3.6025228534345217`*^9, 3.602522949547872*^9}, {3.602523200629318*^9, 
   3.6025232363145742`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["How Many Children?", "Section",
 CellChangeTimes->{{3.6025124502226477`*^9, 3.602512469353609*^9}}],

Cell["\<\
We can add all children to a rectangle using the same orientation. However, \
this leads to narrow rectangles that hard to compare:\
\>", "Text",
 CellChangeTimes->{{3.6025230342121363`*^9, 3.602523070017714*^9}, {
  3.602523156867543*^9, 3.602523158363978*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Block", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"parent", "=", 
     RowBox[{"Rectangle", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "4"}], "}"}]}], "]"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"VisualizeRectangles", "[", "\[IndentingNewLine]", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", "parent", "}"}], ",", 
      RowBox[{"FillRectangle", "[", 
       RowBox[{"parent", ",", 
        RowBox[{"{", 
         RowBox[{
         "6", ",", "6", ",", "4", ",", "3", ",", "2", ",", "2", ",", "1"}], 
         "}"}], ",", "Horizontal"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.602523075173811*^9, 3.602523132934539*^9}}],

Cell[BoxData[
 GraphicsBox[
  {Opacity[
    NCache[
     Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
   RectangleBox[{0, 0}, {6, 4}], 
   {RGBColor[0.65, 0.7, 0.7], 
    RectangleBox[{0, 0}, NCache[{Rational[3, 2], 4}, {1.5, 4}]]}, 
   {RGBColor[0.836713, 1., 1.], 
    RectangleBox[NCache[{Rational[3, 2], 0}, {1.5, 0}], {3, 4}]}, 
   {RGBColor[0.799435, 0.543572, 0.997559], RectangleBox[{3, 0}, {4, 4}]}, 
   {RGBColor[0.770565, 0.964309, 0.0442359], 
    RectangleBox[{4, 0}, NCache[{Rational[19, 4], 4}, {4.75, 4}]]}, 
   {RGBColor[1., 0.709804, 0.709804], 
    RectangleBox[NCache[{Rational[19, 4], 0}, {4.75, 0}], 
     NCache[{Rational[21, 4], 4}, {5.25, 4}]]}, 
   {RGBColor[0.4, 0.4, 0.4], 
    RectangleBox[NCache[{Rational[21, 4], 0}, {5.25, 0}], 
     NCache[{Rational[23, 4], 4}, {5.75, 4}]]}, 
   {RGBColor[0.291989, 0.437977, 0.888609], 
    RectangleBox[NCache[{Rational[23, 4], 0}, {5.75, 0}], {6, 4}]}},
  Axes->True,
  GridLines->Automatic]], "Output",
 CellChangeTimes->{{3.602523115208528*^9, 3.602523133442443*^9}}]
}, Open  ]],

Cell["\<\
The squarified treemap algorithm uses a heuristic to first fill a rectangle \
with children using one orientation, then switch to the opposite orientation, \
and so on. The algorithm places a child rectangles until the worst aspect \
ratio of the group of placed rectangles increases. In other words, rectangles \
are placed until a local minima of the aspect ratio is found. The worst \
aspect ratio is simply the maximum aspect ratio of a list. If the list is \
empty, we define the worst aspect ratio as infinite.\
\>", "Text",
 CellChangeTimes->{{3.6025232738861933`*^9, 3.6025233924873543`*^9}, {
  3.602523443302471*^9, 3.602523456569922*^9}, {3.602523614827455*^9, 
  3.6025236236586943`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WorstAspectRatio", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", "\[Infinity]"}]], "Input",
 CellChangeTimes->{{3.602523626808999*^9, 3.602523632918088*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WorstAspectRatio", "[", "rectangles_List", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Max", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"RectAspectRatio", "[", "#", "]"}], "&"}], "/@", "rectangles"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.602523409481268*^9, 3.602523428986751*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlaceTillLocalMinima", "[", 
   RowBox[{"parent_Rectangle", ",", "areas_List", ",", "orientation_"}], 
   "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"PlaceTillLocalMinima", "[", 
   RowBox[{"parent", ",", "areas", ",", "orientation", ",", 
    RowBox[{"{", "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6025236637728662`*^9, 3.602523697284738*^9}, {
  3.6025237438756742`*^9, 3.602523766666615*^9}}],

Cell["\<\
The PlaceTillLocalMinima (4 argument) function takes a parent rectangle, a \
list of desired areas for child rectangles, an orientation (either Vertical \
or Horizontal), and accumulates a list of rectangles placed using \
FillRectangle.\
\>", "Text",
 CellChangeTimes->{{3.602523800164146*^9, 3.602523871185348*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlaceTillLocalMinima", "[", 
   RowBox[{
   "parent_Rectangle", ",", "areas_List", ",", "orientation_", ",", 
    "placed_List"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "placed", "]"}], "\[Equal]", 
     RowBox[{"Length", "[", "areas", "]"}]}], ",", "placed", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"local", " ", "minima", " ", "achieved"}], " ", "*)"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"placeStep", "=", 
        RowBox[{"FillRectangle", "[", 
         RowBox[{"parent", ",", 
          RowBox[{"Take", "[", 
           RowBox[{"areas", ",", 
            RowBox[{
             RowBox[{"Length", "[", "placed", "]"}], "+", "1"}]}], "]"}], ",",
           "orientation"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"WorstAspectRatio", "[", "placeStep", "]"}], ">", 
         RowBox[{"WorstAspectRatio", "[", "placed", "]"}]}], ",", 
        "\[IndentingNewLine]", "placed", 
        RowBox[{"(*", 
         RowBox[{
         "previous", " ", "step", " ", "had", " ", "local", " ", "minima"}], 
         "*)"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlaceTillLocalMinima", "[", 
         RowBox[{
         "parent", ",", "areas", ",", "orientation", ",", "placeStep"}], 
         "]"}]}], 
       RowBox[{"(*", 
        RowBox[{
        "recurse", " ", "and", " ", "check", " ", "if", " ", "next", " ", 
         "step", " ", "is", " ", "local", " ", "minima"}], "*)"}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.6025237702297897`*^9, 3.602523791086747*^9}, {
  3.6025238915261497`*^9, 3.602523941789757*^9}, {3.602524026759266*^9, 
  3.602524190076623*^9}}],

Cell["\<\
When a local minima is found, the upper-level function will place the \
remaining children using the opposite orientation. This function provides the \
flip:\
\>", "Text",
 CellChangeTimes->{{3.602524519734888*^9, 3.602524551155402*^9}, {
  3.602528093366803*^9, 3.6025280943208857`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvertOrientation", "[", "Horizontal", "]"}], ":=", 
  "Vertical"}]], "Input",
 CellChangeTimes->{{3.602524554015004*^9, 3.6025245606417093`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvertOrientation", "[", "Vertical", "]"}], ":=", 
  "Horizontal"}]], "Input",
 CellChangeTimes->{{3.6025245618519983`*^9, 3.602524568401902*^9}}],

Cell[CellGroupData[{

Cell["Examples: Finding Local Minima", "Subsection",
 CellChangeTimes->{{3.602524224046068*^9, 3.60252422740632*^9}}],

Cell["\<\
The function finds that placing just the first two rectangles reaches the \
local minima:\
\>", "Text",
 CellChangeTimes->{{3.602524411478763*^9, 3.602524425950039*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"PlaceTillLocalMinima", "[", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "6", ",", "4", ",", "3", ",", "2", ",", "2", ",", "1"}],
     "}"}], ",", "Vertical"}], "]"}]], "Input",
 CellChangeTimes->{{3.602464559100952*^9, 3.602464601556774*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.602524266332905*^9, 3.602524296435762*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"WorstAspectRatio", "[", "%", "]"}]], "Input",
 CellChangeTimes->{{3.602524284510524*^9, 3.602524288160162*^9}}],

Cell[BoxData[
 FractionBox["3", "2"]], "Output",
 CellChangeTimes->{{3.602524288632613*^9, 3.602524299016632*^9}}]
}, Open  ]],

Cell["\<\
The worst aspect ratio for the next step (placing 6, 6, and 4) is 4, which is \
greater than 3/2.\
\>", "Text",
 CellChangeTimes->{{3.602524431733433*^9, 3.60252445372563*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"WorstAspectRatio", "[", 
  RowBox[{"FillRectangle", "[", 
   RowBox[{
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"6", ",", "6", ",", "4"}], "}"}], ",", "Vertical"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.60252430365768*^9, 3.602524345457383*^9}}],

Cell[BoxData["4"], "Output",
 CellChangeTimes->{{3.602524333796616*^9, 3.602524345958424*^9}}]
}, Open  ]],

Cell["\<\
Similarly, the function finds the local minima after the first two rectangles:\
\>", "Text",
 CellChangeTimes->{{3.602524461783741*^9, 3.6025244750465183`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"PlaceTillLocalMinima", "[", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "3", ",", "2", ",", "1", ",", "1"}], "}"}], ",", 
   "Horizontal"}], "]"}]], "Input",
 CellChangeTimes->{{3.6024649260007553`*^9, 3.602464975992446*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       FractionBox["33", "7"], ",", 
       FractionBox["7", "3"]}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["33", "7"], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", 
       FractionBox["7", "3"]}], "}"}]}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.6025242748034897`*^9, 3.602524352226582*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"WorstAspectRatio", "[", "%", "]"}]], "Input",
 CellChangeTimes->{{3.602524354322002*^9, 3.6025243587070417`*^9}}],

Cell[BoxData[
 FractionBox["49", "27"]], "Output",
 CellChangeTimes->{3.6025243592168827`*^9}]
}, Open  ]],

Cell["\<\
The worst aspect ratio for the next step (4, 3, and 2) is 9/2, which is \
greater than 49/27.\
\>", "Text",
 CellChangeTimes->{{3.602524480619894*^9, 3.602524497050688*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"WorstAspectRatio", "[", 
  RowBox[{"FillRectangle", "[", 
   RowBox[{
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"3", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"4", ",", "3", ",", "2"}], "}"}], ",", "Horizontal"}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.602524369440652*^9, 3.602524395754919*^9}}],

Cell[BoxData[
 FractionBox["9", "2"]], "Output",
 CellChangeTimes->{{3.6025243913610563`*^9, 3.6025243962292767`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Calculating Remaining Dimensions\
\>", "Section",
 CellChangeTimes->{{3.602512475795643*^9, 3.602512485641571*^9}, {
  3.6025247854485064`*^9, 3.602524790368075*^9}}],

Cell["\<\
After the algorithm has placed a number of children, it will invert \
orientation and place the remaining children. The parent rectangle for the \
first group of children is different than the second group (and the third and \
fourth...) because some of the space has already been consumed. These pair of \
functions are used to calculate the \[OpenCurlyDoubleQuote]new\
\[CloseCurlyDoubleQuote] parent rectangle for the next iteration of rectangle \
placing.\
\>", "Text",
 CellChangeTimes->{{3.602524805925159*^9, 3.6025248831558437`*^9}, {
  3.602524929891733*^9, 3.6025249594868107`*^9}}],

Cell["\<\
First, given a group of placed rectangles, we need to find the bounding box \
around them. Due to the algorithm\[CloseCurlyQuote]s design, the bounding box \
will always be a rectangle flush with the child rectangles.\
\>", "Text",
 CellChangeTimes->{{3.602524971281434*^9, 3.6025250335734253`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"EnclosingRectangle", "[", "rectangles_List", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Rectangle", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Min", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Coord", "[", 
          RowBox[{"Left", ",", "#"}], "]"}], "&"}], "/@", "rectangles"}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Min", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Coord", "[", 
          RowBox[{"Bottom", ",", "#"}], "]"}], "&"}], "/@", "rectangles"}], 
       "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Max", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Coord", "[", 
          RowBox[{"Right", ",", "#"}], "]"}], "&"}], "/@", "rectangles"}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Max", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Coord", "[", 
          RowBox[{"Top", ",", "#"}], "]"}], "&"}], "/@", "rectangles"}], 
       "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.602524989956271*^9, 3.6025249973507147`*^9}, {
  3.602525038278016*^9, 3.602525091143862*^9}}],

Cell["\<\
Second, the remaining rectangle is formed from the right edge of the child \
(if the children were placed Vertically) or from the top edge of the child \
(if the children were placed Horizontally). The top-right corner is always \
equal to the parent.\
\>", "Text",
 CellChangeTimes->{{3.6025252130227823`*^9, 3.602525214862007*^9}, {
  3.6025252460093412`*^9, 3.602525333697448*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"RemainingRectangle", "[", 
   RowBox[{"parent_Rectangle", ",", "child_Rectangle"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Rectangle", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Coord", "[", 
           RowBox[{"Bottom", ",", "parent"}], "]"}], "\[Equal]", 
          RowBox[{"Coord", "[", 
           RowBox[{"Bottom", ",", "child"}], "]"}]}], "\[And]", 
         RowBox[{
          RowBox[{"Coord", "[", 
           RowBox[{"Top", ",", "parent"}], "]"}], "\[Equal]", 
          RowBox[{"Coord", "[", 
           RowBox[{"Top", ",", "child"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Coord", "[", 
         RowBox[{"Right", ",", "child"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", "else", "*)"}], 
        RowBox[{"Coord", "[", 
         RowBox[{"Left", ",", "parent"}], "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Coord", "[", 
           RowBox[{"Left", ",", "parent"}], "]"}], "\[Equal]", 
          RowBox[{"Coord", "[", 
           RowBox[{"Left", ",", "child"}], "]"}]}], "\[And]", 
         RowBox[{
          RowBox[{"Coord", "[", 
           RowBox[{"Right", ",", "parent"}], "]"}], "\[Equal]", 
          RowBox[{"Coord", "[", 
           RowBox[{"Right", ",", "child"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Coord", "[", 
         RowBox[{"Top", ",", "child"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", "else", "*)"}], 
        RowBox[{"Coord", "[", 
         RowBox[{"Bottom", ",", "parent"}], "]"}]}], "\[IndentingNewLine]", 
       "]"}]}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Coord", "[", 
       RowBox[{"Right", ",", "parent"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Coord", "[", 
       RowBox[{"Top", ",", "parent"}], "]"}]}], "}"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.602525341108864*^9, 3.602525552121573*^9}, {
   3.6025256291924133`*^9, 3.602525631395536*^9}, {3.602525730886643*^9, 
   3.602525797377911*^9}, {3.6025258704702177`*^9, 3.602525906579726*^9}, 
   3.6025281158347387`*^9}],

Cell[CellGroupData[{

Cell["Examples: Remaining Rectangle", "Subsection",
 CellChangeTimes->{{3.602525559447259*^9, 3.602525564062153*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"EnclosingRectangle", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "2"}], "}"}]}], "]"}], ",", 
    RowBox[{"Rectangle", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.602508564206484*^9, 3.602508580703615*^9}}],

Cell[BoxData[
 RowBox[{"Rectangle", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.602525580524671*^9, 3.6025256340417013`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"RemainingRectangle", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}]}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6025095349528103`*^9, 3.6025095709879093`*^9}, {
  3.602525679824584*^9, 3.602525682392097*^9}}],

Cell[BoxData[
 RowBox[{"Rectangle", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "4"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{
  3.602525592859537*^9, {3.602525636405671*^9, 3.602525637954722*^9}, 
   3.602525683037286*^9, {3.6025257868083277`*^9, 3.602525801335484*^9}, 
   3.602525915092927*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"RemainingRectangle", "[", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"EnclosingRectangle", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Rectangle", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          FractionBox["33", "7"], ",", 
          FractionBox["7", "3"]}], "}"}]}], "]"}], ",", 
      RowBox[{"Rectangle", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          FractionBox["33", "7"], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", 
          FractionBox["7", "3"]}], "}"}]}], "]"}]}], "}"}], "]"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.602509594629032*^9, 3.602509607460833*^9}, {
  3.602509650364799*^9, 3.6025096535873938`*^9}}],

Cell[BoxData[
 RowBox[{"Rectangle", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", 
     FractionBox["7", "3"]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "4"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.602525928469672*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"RemainingRectangle", "[", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.602509673908774*^9, 3.6025096981155024`*^9}}],

Cell[BoxData[
 RowBox[{"Rectangle", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.602525942830286*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Squarify Algorithm", "Section",
 CellChangeTimes->{{3.602512491102111*^9, 3.602512495966441*^9}}],

Cell["\<\
With all the pieces together, we can now write the Squarify function. This \
function takes a parent rectangle and a list of areas (whose sum must equal \
the area of the parent) and returns a list of Rectangles.\
\>", "Text",
 CellChangeTimes->{{3.602526064955402*^9, 3.602526111246966*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Squarify", "[", 
   RowBox[{"parent_Rectangle", ",", "areas_List"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Squarify", "[", 
   RowBox[{"parent", ",", "areas", ",", 
    RowBox[{"{", "}"}], ",", "Vertical"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.602526115517047*^9, 3.602526130735602*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Squarify", "[", 
   RowBox[{
   "parent_Rectangle", ",", "areas_List", ",", "placed_List", ",", 
    "orientation_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "areas", "]"}], "\[Equal]", "0"}], ",", "placed", 
    
    RowBox[{"(*", "done", "*)"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"placeThisStep", "=", 
        RowBox[{"PlaceTillLocalMinima", "[", 
         RowBox[{"parent", ",", "areas", ",", "orientation"}], "]"}]}], "}"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{"Squarify", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"RemainingRectangle", "[", 
         RowBox[{"parent", ",", 
          RowBox[{"EnclosingRectangle", "[", "placeThisStep", "]"}]}], "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Drop", "[", 
         RowBox[{"areas", ",", 
          RowBox[{"Length", "[", "placeThisStep", "]"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Join", "[", 
         RowBox[{"placed", ",", "placeThisStep"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"InvertOrientation", "[", "orientation", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.60252613590569*^9, 3.602526238114336*^9}}],

Cell[CellGroupData[{

Cell["Example: Squarify", "Subsection",
 CellChangeTimes->{{3.602526247588767*^9, 3.602526252113686*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Squarify", "[", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "6", ",", "4", ",", "3", ",", "2", ",", "2", ",", "1"}],
     "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.602526257658289*^9, 3.6025262731962957`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       FractionBox["33", "7"], ",", 
       FractionBox["7", "3"]}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["33", "7"], ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", 
       FractionBox["7", "3"]}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", 
       FractionBox["7", "3"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       FractionBox["21", "5"], ",", "4"}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["21", "5"], ",", 
       FractionBox["7", "3"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", 
       FractionBox["31", "9"]}], "}"}]}], "]"}], ",", 
   RowBox[{"Rectangle", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["21", "5"], ",", 
       FractionBox["31", "9"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4"}], "}"}]}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.602526274535469*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"VisualizeRectangles", "[", "%", "]"}]], "Input",
 CellChangeTimes->{{3.602526278503984*^9, 3.602526281898493*^9}}],

Cell[BoxData[
 GraphicsBox[
  {Opacity[
    NCache[
     Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
   RectangleBox[{0, 0}, {3, 2}], 
   {RGBColor[0.65, 0.7, 0.7], RectangleBox[{0, 2}, {3, 4}]}, 
   {RGBColor[0.836713, 1., 1.], 
    RectangleBox[{3, 0}, 
     NCache[{Rational[33, 7], Rational[7, 3]}, {4.714285714285714, 
      2.3333333333333335`}]]}, 
   {RGBColor[0.799435, 0.543572, 0.997559], 
    RectangleBox[NCache[{Rational[33, 7], 0}, {4.714285714285714, 0}], 
     NCache[{6, Rational[7, 3]}, {6, 2.3333333333333335`}]]}, 
   {RGBColor[0.770565, 0.964309, 0.0442359], 
    RectangleBox[NCache[{3, Rational[7, 3]}, {3, 2.3333333333333335`}], 
     NCache[{Rational[21, 5], 4}, {4.2, 4}]]}, 
   {RGBColor[1., 0.709804, 0.709804], 
    RectangleBox[
     NCache[{Rational[21, 5], Rational[7, 3]}, {4.2, 2.3333333333333335`}], 
     NCache[{6, Rational[31, 9]}, {6, 3.4444444444444446`}]]}, 
   {RGBColor[0.4, 0.4, 0.4], 
    RectangleBox[
     NCache[{Rational[21, 5], Rational[31, 9]}, {4.2, 
      3.4444444444444446`}], {6, 4}]}},
  Axes->True,
  GridLines->Automatic]], "Output",
 CellChangeTimes->{3.602526282371521*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Dealing with User Data", "Section",
 CellChangeTimes->{{3.6025124987310333`*^9, 3.602512501265431*^9}, 
   3.60251281896754*^9}],

Cell[TextData[{
 "The previous functions relied on the fact that the area of the parent \
rectangle was greater than or equal to the sum of the areas. User data, \
however, will typically need to be scaled. ",
 StyleBox["Treemap",
  FontSlant->"Italic"],
 " is a wrapper function that performs this scaling and returns a graphic \
object generated using VisualizeRectangles for largely arbitrary data. (This \
function also sorts the values in descending order. According to the original \
paper, this produces the best results.)"
}], "Text",
 CellChangeTimes->{{3.602526350709094*^9, 3.6025264182344313`*^9}, {
  3.60252645425872*^9, 3.602526490762808*^9}, {3.60252687868268*^9, 
  3.602526902422494*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Treemap", "[", 
   RowBox[{"width_Integer", ",", "height_Integer", ",", "values_List"}], 
   "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"safeValues", "=", 
       RowBox[{"Sort", "[", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"values", ",", 
           RowBox[{
            RowBox[{"#", ">", "0"}], "&"}]}], "]"}], ",", "Greater"}], 
        "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"parentArea", "=", 
       RowBox[{"width", "*", "height"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"VisualizeRectangles", "[", "\[IndentingNewLine]", 
     RowBox[{"Squarify", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Rectangle", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"width", ",", "height"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"safeValues", "*", 
        RowBox[{"(", 
         RowBox[{"parentArea", "/", 
          RowBox[{"Total", "[", "safeValues", "]"}]}], ")"}]}]}], 
      "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.602526506817182*^9, 3.602526553463749*^9}, {
  3.6025266266218863`*^9, 3.602526628261053*^9}, {3.602526667828948*^9, 
  3.602526778576936*^9}, {3.6025268489014587`*^9, 3.6025268675483503`*^9}, {
  3.602526962997233*^9, 3.602526963214738*^9}}],

Cell[CellGroupData[{

Cell["Example: Treemap", "Subsection",
 CellChangeTimes->{{3.602526799642879*^9, 3.602526819825087*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Treemap", "[", 
  RowBox[{"320", ",", "240", ",", 
   RowBox[{"{", 
    RowBox[{
    "858", ",", "1020", ",", "1119", ",", "715", ",", "976", ",", "857", ",", 
     "900"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.602526824357456*^9, 3.6025268357201*^9}, {
  3.602526908921444*^9, 3.602526943989896*^9}}],

Cell[BoxData[
 GraphicsBox[
  {Opacity[
    NCache[
     Rational[7, 10], 0.7]], EdgeForm[{GrayLevel[0], Thickness[Large]}], 
   RectangleBox[{0, 0}, 
    NCache[{Rational[136896, 1289], Rational[89520, 713]}, {106.2032583397983,
      125.55399719495091`}]], 
   {RGBColor[0.65, 0.7, 0.7], 
    RectangleBox[NCache[{0, Rational[89520, 713]}, {0, 125.55399719495091`}], 
     NCache[{Rational[136896, 1289], 240}, {106.2032583397983, 240}]]}, 
   {RGBColor[0.836713, 1., 1.], 
    RectangleBox[NCache[{Rational[136896, 1289], 0}, {106.2032583397983, 0}], 
     NCache[{Rational[131446720, 604541], Rational[225120, 2153]}, {
      217.4322667941463, 104.56107756618671`}]]}, 
   {RGBColor[0.799435, 0.543572, 0.997559], 
    RectangleBox[
     NCache[{Rational[131446720, 604541], 0}, {217.4322667941463, 0}], 
     NCache[{320, Rational[225120, 2153]}, {320, 104.56107756618671`}]]}, 
   {RGBColor[0.770565, 0.964309, 0.0442359], 
    RectangleBox[
     NCache[{Rational[136896, 1289], Rational[225120, 2153]}, {
      106.2032583397983, 104.56107756618671`}], 
     NCache[{Rational[94851392, 522045], 240}, {
      181.69198440747445`, 240}]]}, 
   {RGBColor[1., 0.709804, 0.709804], 
    RectangleBox[
     NCache[{Rational[94851392, 522045], Rational[225120, 2153]}, {
      181.69198440747445`, 104.56107756618671`}], 
     NCache[{320, Rational[50315820, 282043]}, {
      320, 178.39769113220325`}]]}, 
   {RGBColor[0.4, 0.4, 0.4], 
    RectangleBox[
     NCache[{Rational[94851392, 522045], Rational[50315820, 282043]}, {
      181.69198440747445`, 178.39769113220325`}], {320, 240}]}},
  Axes->True,
  GridLines->Automatic]], "Output",
 CellChangeTimes->{{3.602526944948555*^9, 3.602526965804633*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["References", "Section",
 CellChangeTimes->{{3.60251282128321*^9, 3.602512836855584*^9}}],

Cell[TextData[{
 "\t",
 StyleBox["1",
  FontVariations->{"CompatibilityType"->"Superscript"}],
 "\t",
 "M",
 ".",
 " ",
 "Bruls",
 ",",
 " ",
 "K",
 ".",
 " ",
 "Huizing",
 ",",
 " ",
 "and",
 " ",
 "J",
 ".",
 " ",
 "van",
 " ",
 "Wijk",
 ",",
 " ",
 "\"Squarified treemaps,\"",
 " ",
 "in",
 " ",
 "Proceedings",
 " ",
 "of",
 " ",
 "the",
 " ",
 "Joint",
 " ",
 "Eurographics",
 " ",
 "and",
 " ",
 "IEEE",
 " ",
 "TCVG",
 " ",
 "Symposium",
 " ",
 "on",
 " ",
 "Visualization",
 ",",
 " ",
 "pp",
 ".",
 " ",
 "33",
 "-",
 "42",
 ",",
 " ",
 "2000.",
 " "
}], "Reference",
 Editable->False,
 TaggingRules->{ReferenceNoteData -> ""},
 CellTags->"00007748"],

Cell[TextData[{
 "\t",
 StyleBox["2",
  FontVariations->{"CompatibilityType"->"Superscript"}],
 "\t",
 "http",
 ":",
 "//",
 "en",
 ".",
 "wikipedia",
 ".",
 "org",
 "/",
 "wiki",
 "/",
 "File",
 ":",
 "Tree_Map",
 ".",
 "png"
}], "Reference",
 Editable->False,
 TaggingRules->{ReferenceNoteData -> ""},
 CellTags->"000035FD"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{740, 867},
WindowMargins->{{Automatic, 268}, {Automatic, 63}},
PrintingCopies->1,
PrintingPageRange->{Automatic, Automatic},
PrintingOptions->{"PaperOrientation"->"Portrait",
"PaperSize"->{Automatic, Automatic},
"PostScriptOutputFile"->""},
ShowSelection->True,
FrontEndVersion->"9.0 for Linux x86 (64-bit) (February 7, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Info3602488790-5614751"->{
  Cell[4958, 135, 1545, 27, 101, "Print",
   CellTags->"Info3602488790-5614751"]},
 "000035FD"->{
  Cell[60376, 1753, 326, 24, 30, "Reference",
   CellTags->"000035FD"]},
 "00007748"->{
  Cell[59714, 1684, 659, 67, 46, "Reference",
   CellTags->"00007748"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Info3602488790-5614751", 61230, 1797},
 {"000035FD", 61328, 1800},
 {"00007748", 61416, 1803}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 100, 1, 93, "Title"],
Cell[682, 25, 183, 5, 51, "Subtitle"],
Cell[868, 32, 116, 1, 31, "Subsubtitle"],
Cell[CellGroupData[{
Cell[1009, 37, 93, 1, 81, "Section"],
Cell[1105, 40, 1328, 28, 81, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2470, 73, 99, 1, 81, "Section"],
Cell[2572, 76, 1579, 28, 221, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4188, 109, 131, 3, 81, "Section"],
Cell[4322, 114, 250, 5, 51, "Text"],
Cell[4575, 121, 237, 6, 51, "Text"],
Cell[CellGroupData[{
Cell[4837, 131, 118, 2, 32, "Input"],
Cell[4958, 135, 1545, 27, 101, "Print",
 CellTags->"Info3602488790-5614751"]
}, Open  ]],
Cell[6518, 165, 277, 5, 51, "Text"],
Cell[6798, 172, 658, 17, 143, "Input"],
Cell[7459, 191, 390, 10, 32, "Input"],
Cell[7852, 203, 389, 10, 32, "Input"],
Cell[8244, 215, 252, 6, 32, "Input"],
Cell[8499, 223, 419, 7, 91, "Text"],
Cell[8921, 232, 1066, 27, 143, "Input"],
Cell[CellGroupData[{
Cell[10012, 263, 117, 1, 45, "Subsection"],
Cell[CellGroupData[{
Cell[10154, 268, 671, 19, 99, "Input"],
Cell[10828, 289, 158, 4, 49, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[11047, 300, 109, 1, 81, "Section"],
Cell[11159, 303, 516, 10, 91, "Text"],
Cell[11678, 315, 1323, 28, 231, "Input"],
Cell[13004, 345, 112, 1, 31, "Text"],
Cell[CellGroupData[{
Cell[13141, 350, 1318, 38, 143, "Input"],
Cell[14462, 390, 999, 21, 267, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[15510, 417, 106, 1, 81, "Section"],
Cell[15619, 420, 619, 10, 131, "Text"],
Cell[16241, 432, 553, 9, 111, "Text"],
Cell[CellGroupData[{
Cell[16819, 445, 104, 1, 45, "Subsection"],
Cell[16926, 448, 251, 6, 32, "Input"],
Cell[17180, 456, 2278, 60, 341, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19495, 521, 105, 1, 45, "Subsection"],
Cell[19603, 524, 251, 6, 32, "Input"],
Cell[19857, 532, 2324, 61, 341, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22218, 598, 140, 3, 45, "Subsection"],
Cell[CellGroupData[{
Cell[22383, 605, 2978, 74, 429, "Input"],
Cell[25364, 681, 2796, 67, 100, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[28221, 755, 105, 1, 81, "Section"],
Cell[28329, 758, 272, 5, 51, "Text"],
Cell[CellGroupData[{
Cell[28626, 767, 868, 23, 165, "Input"],
Cell[29497, 792, 1063, 23, 267, "Output"]
}, Open  ]],
Cell[30575, 818, 710, 11, 131, "Text"],
Cell[31288, 831, 188, 4, 32, "Input"],
Cell[31479, 837, 332, 9, 55, "Input"],
Cell[31814, 848, 442, 9, 55, "Input"],
Cell[32259, 859, 327, 6, 71, "Text"],
Cell[32589, 867, 1955, 47, 319, "Input"],
Cell[34547, 916, 298, 6, 51, "Text"],
Cell[34848, 924, 181, 4, 32, "Input"],
Cell[35032, 930, 181, 4, 32, "Input"],
Cell[CellGroupData[{
Cell[35238, 938, 117, 1, 45, "Subsection"],
Cell[35358, 941, 179, 4, 31, "Text"],
Cell[CellGroupData[{
Cell[35562, 949, 451, 12, 55, "Input"],
Cell[36016, 963, 473, 15, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[36526, 983, 135, 2, 32, "Input"],
Cell[36664, 987, 114, 2, 49, "Output"]
}, Open  ]],
Cell[36793, 992, 186, 4, 51, "Text"],
Cell[CellGroupData[{
Cell[37004, 1000, 453, 13, 55, "Input"],
Cell[37460, 1015, 94, 1, 32, "Output"]
}, Open  ]],
Cell[37569, 1019, 170, 3, 31, "Text"],
Cell[CellGroupData[{
Cell[37764, 1026, 434, 12, 55, "Input"],
Cell[38201, 1040, 581, 19, 49, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[38819, 1064, 137, 2, 32, "Input"],
Cell[38959, 1068, 94, 2, 49, "Output"]
}, Open  ]],
Cell[39068, 1073, 183, 4, 31, "Text"],
Cell[CellGroupData[{
Cell[39276, 1081, 456, 13, 55, "Input"],
Cell[39735, 1096, 118, 2, 49, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[39914, 1105, 176, 4, 81, "Section"],
Cell[40093, 1111, 602, 10, 111, "Text"],
Cell[40698, 1123, 309, 5, 71, "Text"],
Cell[41010, 1130, 1239, 35, 165, "Input"],
Cell[42252, 1167, 394, 7, 71, "Text"],
Cell[42649, 1176, 2394, 59, 341, "Input"],
Cell[CellGroupData[{
Cell[45068, 1239, 117, 1, 45, "Subsection"],
Cell[CellGroupData[{
Cell[45210, 1244, 532, 16, 55, "Input"],
Cell[45745, 1262, 250, 7, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[46032, 1274, 595, 16, 77, "Input"],
Cell[46630, 1292, 375, 10, 32, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47042, 1307, 969, 30, 138, "Input"],
Cell[48014, 1339, 250, 8, 49, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[48301, 1352, 498, 15, 55, "Input"],
Cell[48802, 1369, 226, 7, 32, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[49089, 1383, 103, 1, 81, "Section"],
Cell[49195, 1386, 302, 5, 71, "Text"],
Cell[49500, 1393, 340, 8, 55, "Input"],
Cell[49843, 1403, 1472, 35, 341, "Input"],
Cell[CellGroupData[{
Cell[51340, 1442, 105, 1, 45, "Subsection"],
Cell[CellGroupData[{
Cell[51470, 1447, 424, 12, 32, "Input"],
Cell[51897, 1461, 1634, 56, 162, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53568, 1522, 138, 2, 32, "Input"],
Cell[53709, 1526, 1160, 27, 267, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[54930, 1560, 134, 2, 81, "Section"],
Cell[55067, 1564, 706, 13, 131, "Text"],
Cell[55776, 1579, 1576, 39, 253, "Input"],
Cell[CellGroupData[{
Cell[57377, 1622, 104, 1, 45, "Subsection"],
Cell[CellGroupData[{
Cell[57506, 1627, 336, 8, 32, "Input"],
Cell[57845, 1637, 1711, 37, 286, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[59617, 1681, 94, 1, 81, "Section"],
Cell[59714, 1684, 659, 67, 46, "Reference",
 CellTags->"00007748"],
Cell[60376, 1753, 326, 24, 30, "Reference",
 CellTags->"000035FD"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
